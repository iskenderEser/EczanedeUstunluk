<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eczanede ÃœstÃ¼nlÃ¼k â€” KarlÄ±lÄ±k Hesaplama</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --red: #e63946;
  --green: #007d0c;
  --bg: #ffffff;
  --surface: #f5f7fa;
  --border: #dde1ea;
  --text: #1a1f2e;
  --muted: #6b7280;
  --light: #f9fafb;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  min-height: 100vh;
  padding: 40px 20px 80px;
}
.container { max-width: 960px; margin: 0 auto; }
header { display: block; text-align: center; margin-bottom: 40px; }
.header-text h1 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(28px, 5vw, 48px);
  letter-spacing: 2px; line-height: 1;
}

/* Geri Ã¶demesiz modda Ã§Ä±ktÄ± tek sÃ¼tun */
body.mod-geri-odemsiz .cikti-elden-wrap { display: none !important; }
body.mod-geri-odemsiz .cikti-deger-cell { grid-template-columns: 1fr !important; }
body.mod-geri-odemsiz .cikti-kamu-elden-baslik { display: none !important; }
body.mod-geri-odemsiz .geri-odemeli-only { display: none !important; }

/* DSF manuel/otomatik gÃ¶rÃ¼nÃ¼m */
.dsf-input-otomatik { background: #f0fdf8 !important; color: #007d0c !important; border-color: #007d0c !important; cursor: default; }
.dsf-input-manuel { background: #fff !important; color: var(--text) !important; border-color: var(--border) !important; cursor: text; }




.accordion { display: flex; flex-direction: column; gap: 16px; }
.acc-item { border: 1px solid var(--border); border-radius: 16px; overflow: visible; }
.acc-header {
  display: flex; align-items: center; gap: 16px;
  padding: 20px 24px; cursor: pointer; user-select: none;
  transition: background 0.15s; background: var(--surface); border-radius: 16px;
}
.acc-header:hover { background: #eef1f6; }
.acc-title { flex: 1; }
.acc-title h3 { font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 1px; }
.acc-chevron { font-size: 18px; color: var(--muted); transition: transform 0.25s; }
.acc-item.open .acc-chevron { transform: rotate(180deg); }
.acc-body { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; }
.acc-item.open .acc-body { max-height: 9999px; }
.acc-content { padding: 16px; border-top: 1px solid var(--border); }

.inner-acc-item { border-radius: 14px; border: 1px solid var(--border); }
.inner-acc-item + .inner-acc-item { margin-top: 12px; }
.inner-acc-body { max-height: 0; overflow: hidden; transition: max-height 0.6s ease; }
.inner-acc-item.open .inner-acc-body { max-height: 9999px; }
.inner-acc-item.open .acc-chevron { transform: rotate(180deg); }
.inner-acc-header {
  display: flex; align-items: center; gap: 16px;
  padding: 14px 20px; cursor: pointer; user-select: none;
  background: #f9fafb; border-radius: 14px;
}

/* â”€â”€ YATAY KAYDIRMALI TABLO â”€â”€ */
.tablo-scroll-wrap {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-top: 1px solid var(--border);
}

/* GÄ°RDÄ°LER */
.girdi-tablo { display: flex; flex-direction: row; min-width: max-content; width: 100%; }

.girdi-etiket-col {
  min-width: 180px; width: 180px; max-width: 180px; flex-shrink: 0;
  background: #f9fafb; border-right: 2px solid var(--border);
  position: sticky; left: 0; z-index: 5;
  overflow: hidden;
}

.girdi-urun-col { min-width: 220px; flex: 1; border-right: 1px solid var(--border); }
.girdi-urun-col:last-child { border-right: none; }

.girdi-etiket-cell {
  padding: 10px 14px; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; min-height: 64px;
  font-size: 11px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 1px; color: var(--muted); line-height: 1.4;
}
.girdi-etiket-cell.baslik {
  min-height: 96px; background: #f0fdf8;
  border-bottom: 2px solid var(--border);
}
.girdi-etiket-cell.referans { min-height: 70px; }
.girdi-etiket-cell.separator {
  min-height: 24px; background: #f0f4ff;
  border-bottom: 1px solid #c7d2fe;
  font-size: 9px; color: #6366f1; letter-spacing: 1.5px; padding: 4px 14px;
}
.girdi-etiket-cell.last { border-bottom: none; }

.girdi-input-cell {
  padding: 10px 10px; border-bottom: 1px solid var(--border);
  min-height: 64px; display: flex; align-items: center;
}
.girdi-input-cell.baslik {
  min-height: 96px; flex-direction: column; align-items: stretch;
  gap: 8px; background: linear-gradient(135deg, #f0fdf8, #e6f7f2);
  border-bottom: 2px solid var(--border); justify-content: center; padding: 10px 12px;
}
.girdi-input-cell.baslik.rakip-1 { background: linear-gradient(135deg, #d5f5e3, #b8edce); }
.girdi-input-cell.baslik.rakip-2 { background: linear-gradient(135deg, #b8edce, #96e4b3); }
.girdi-input-cell.referans { min-height: 70px; }
.girdi-input-cell.separator {
  min-height: 24px; background: #f0f4ff;
  border-bottom: 1px solid #c7d2fe; padding: 0;
}
.girdi-input-cell.last { border-bottom: none; }

.urun-baslik-isim { font-size: 13px; font-weight: 700; color: #007d0c; letter-spacing: 0.5px; }
.urun-baslik-isim.rakip-1 { color: #006b0a; }
.urun-baslik-isim.rakip-2 { color: #005a08; }
.urun-baslik-aksiyonlar { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }

.girdi-input-cell input,
.girdi-input-cell select {
  width: 100%; background: #fff; border: 1px solid var(--border);
  border-radius: 10px; padding: 9px 12px; color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 13px; outline: none;
  transition: border-color 0.2s, box-shadow 0.2s; height: 42px;
}
.girdi-input-cell input:focus,
.girdi-input-cell select:focus {
  border-color: var(--red); box-shadow: 0 0 0 3px rgba(230,57,70,0.1);
}
.girdi-input-cell input::placeholder { color: #c0c8d8; }
.girdi-input-cell input[readonly] {
  background: #f0fdf8; border-color: #007d0c;
  color: #007d0c; font-weight: 600; text-align: center;
}
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
input[type=number] { -moz-appearance: textfield; }
.girdi-input-cell select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b7280' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 10px center;
  padding-right: 28px; cursor: pointer;
}

/* Ã‡IKTILAR */
.cikti-tablo { display: flex; flex-direction: row; min-width: max-content; width: 100%; }

.cikti-etiket-col {
  min-width: 180px; width: 180px; max-width: 180px; flex-shrink: 0;
  background: #f9fafb; border-right: 2px solid var(--border);
  position: sticky; left: 0; z-index: 5;
  overflow: hidden;
}

.cikti-urun-col { min-width: 280px; flex: 1; border-right: 1px solid var(--border); }
.cikti-urun-col:last-child { border-right: none; }

.cikti-etiket-cell {
  padding: 12px 14px; border-bottom: 1px dashed var(--border);
  display: flex; align-items: center;
  font-size: 12px; font-weight: 500; color: var(--text); line-height: 1.5;
}
.cikti-etiket-cell.baslik {
  background: #f0fdf8; border-bottom: 2px solid var(--border);
  font-size: 11px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 1px; color: var(--muted);
}
.cikti-etiket-cell.thick { border-bottom: 2px solid var(--border); }
.cikti-etiket-cell.last { border-bottom: none; }

/* SatÄ±r yÃ¼kseklikleri â€” etiket ve veri sÃ¼tunlarÄ± aynÄ± olmalÄ± */
.cikti-row-baslik   { height: 72px; }
.cikti-row-alis     { height: 88px; }
.cikti-row-mf       { height: 88px; }
.cikti-row-valor-t  { height: 88px; }
.cikti-row-valor-f  { height: 88px; }
.cikti-row-toplam-t { height: 88px; }
.cikti-row-toplam-f { height: 88px; }

.cikti-urun-baslik {
  min-height: 72px; border-bottom: 2px solid var(--border);
  background: linear-gradient(135deg, #f0fdf8, #e6f7f2);
  display: flex; flex-direction: column; justify-content: center;
}
.cikti-urun-baslik.rakip-1 { background: linear-gradient(135deg, #d5f5e3, #b8edce); }
.cikti-urun-baslik.rakip-2 { background: linear-gradient(135deg, #b8edce, #96e4b3); }

.cikti-urun-baslik-isim {
  padding: 8px 12px 4px; font-size: 12px; font-weight: 700; color: #007d0c;
  text-align: center;
}
.cikti-urun-baslik-isim.rakip-1 { color: #006b0a; }
.cikti-urun-baslik-isim.rakip-2 { color: #005a08; }

.cikti-kamu-elden-baslik { display: grid; grid-template-columns: 1fr 1fr; }
.cikti-kamu-elden-baslik > div {
  padding: 4px 12px 8px; font-size: 10px; font-weight: 600;
  letter-spacing: 1px; color: var(--muted); text-transform: uppercase; text-align: center;
}
.cikti-kamu-elden-baslik > div:first-child { border-right: 1px solid rgba(0,125,12,0.25); }

.cikti-deger-cell {
  display: grid; grid-template-columns: 1fr 1fr;
  border-bottom: 1px dashed var(--border);
}
.cikti-deger-cell.thick { border-bottom: 2px solid var(--border); }
.cikti-deger-cell.last { border-bottom: none; }
.cikti-deger-cell.span2 { grid-template-columns: 1fr; }

.cikti-kamu-wrap, .cikti-elden-wrap {
  padding: 8px; display: flex; flex-direction: column;
  gap: 4px; justify-content: center;
}
.cikti-kamu-wrap { border-right: 1px solid var(--border); }
.cikti-deger-cell.span2 .cikti-kamu-wrap { border-right: none; padding: 8px 12px; }

.cikti-input {
  background: #f0fdf8; border: 1px solid #007d0c; color: #007d0c;
  font-weight: 600; border-radius: 8px; padding: 6px 8px; font-size: 12px;
  text-align: center; width: 100%; height: 36px; box-sizing: border-box; outline: none;
}
.cikti-pct {
  background: #f0f4ff; border: 1px solid #6366f1; color: #6366f1;
  font-weight: 600; border-radius: 8px; padding: 4px 8px; font-size: 11px;
  text-align: center; width: 100%; height: 28px; box-sizing: border-box; outline: none;
}
.cikti-pct::placeholder { font-size: 8px; color: #c0c8d8; font-weight: 400; }

/* Butonlar */
.urun-ekle-btn {
  display: inline-flex; align-items: center; padding: 3px 10px 3px 6px;
  border-radius: 20px; background: #007d0c; color: white; font-size: 12px;
  font-weight: 600; cursor: pointer; user-select: none; line-height: 1.4;
}
.urun-ekle-btn:hover { background: #006b0a; }
.urun-kapat-btn {
  display: inline-flex; align-items: center; justify-content: center;
  width: 28px; height: 28px;
  color: #b0b8c8; font-size: 24px; font-weight: 300;
  cursor: pointer; user-select: none; line-height: 1;
  flex-shrink: 0; transition: color 0.2s;
}
.urun-kapat-btn:hover { color: #007d0c; }

.result-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
@media (max-width: 600px) { .result-grid { grid-template-columns: 1fr 1fr; } }
.result-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; }
.result-card .rc-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 6px; }
.result-card .rc-value { font-size: 20px; font-weight: 600; color: var(--text); line-height: 1.2; }
.result-card .rc-value.positive { color: #007d0c; }
.result-card .rc-value.negative { color: var(--red); }
.result-card .rc-sub { font-size: 11px; color: var(--muted); margin-top: 3px; }

@media (max-width: 480px) {
  .container { padding: 8px; }
  .girdi-etiket-col { min-width: 140px; width: 140px; }
  .girdi-urun-col { min-width: 190px; }
  .cikti-etiket-col { min-width: 160px; width: 160px; }
  .cikti-urun-col { min-width: 230px; }
}
</style>
</head>
<body>
<div class="container">

  <header style="text-align:center;">
    <div class="header-text">
      <h1><span style="color:#737373;">ECZANEDE</span> <span style="color:#007d0c;">ÃœSTÃœNLÃœK</span></h1>
    </div>
  </header>

  <!-- SUB BAÅLIK + TOGGLE -->
  <div style="text-align:center;margin-bottom:32px;">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:#737373;margin-bottom:24px;">Ticari Avantaj Hesaplama</div>
    <div style="display:inline-flex;align-items:center;gap:20px;">
      <span id="lbl-geri-odemeli" style="font-size:15px;font-weight:600;color:#007d0c;transition:color 0.2s;">Geri Ã–demeli</span>
      <div id="toggle-btn" onclick="toggleMod()" style="width:56px;height:30px;background:#007d0c;border-radius:15px;cursor:pointer;position:relative;transition:background 0.3s;flex-shrink:0;">
        <div id="toggle-knob" style="width:24px;height:24px;background:#fff;border-radius:50%;position:absolute;top:3px;left:3px;transition:left 0.3s;box-shadow:0 1px 4px rgba(0,0,0,0.2);"></div>
      </div>
      <span id="lbl-geri-odemsiz" style="font-size:15px;font-weight:600;color:#b0b8c8;transition:color 0.2s;">Geri Ã–demesiz</span>
    </div>
  </div>

  <div style="border: 1px solid var(--border); border-radius: 16px; overflow: visible;">
    <div style="padding: 16px 20px; display:flex; align-items:center; justify-content:space-between; border-bottom: 1px solid var(--border); background: var(--surface); border-radius: 16px 16px 0 0;">
      <h3 id="acc-main-baslik" style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1.5px;color:#737373;">Geri Ã–demeli ÃœrÃ¼nler Ä°Ã§in Ticari Avantaj Hesaplama</h3>
      <div onclick="temizle()" style="font-size:11px;color:#b0b8c8;font-weight:500;cursor:pointer;padding:4px 10px;border-radius:20px;border:1px solid #d1d5db;transition:all 0.2s;white-space:nowrap;" onmouseover="this.style.color='#007d0c';this.style.borderColor='#007d0c'" onmouseout="this.style.color='#b0b8c8';this.style.borderColor='#d1d5db'">Temizle</div>
    </div>
    <div style="padding: 16px;">

          <!-- GÄ°RDÄ°LER -->
          <div class="inner-acc-item" id="acc-girdiler" style="margin-bottom:12px;">
            <div class="inner-acc-header" onclick="event.stopPropagation(); innerToggle('girdiler')">
              <div class="acc-title">
                <h3 style="font-size:13px;letter-spacing:1.5px;color:#6b7280;">GÄ°RDÄ°LER</h3>
              </div>
              <div class="acc-chevron">â–¼</div>
            </div>
            <div class="inner-acc-body">
              <div class="tablo-scroll-wrap">
                <div class="girdi-tablo" id="girdi-tablo">

                  <!-- SOL SABÄ°T ETÄ°KET SÃœTUNU -->
                  <div class="girdi-etiket-col">
                    <div class="girdi-etiket-cell baslik"></div>
                    <div class="girdi-etiket-cell referans">ÃœrÃ¼n AdÄ±</div>
                    <div class="girdi-etiket-cell referans geri-odemeli-only">Referans Uygulama</div>
                    <div class="girdi-etiket-cell">PSF<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(KDV Dahil)</span></div>
                    <div class="girdi-etiket-cell">PSF<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(KDV HariÃ§)</span></div>
                    <div class="girdi-etiket-cell">DSF<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(KDV HariÃ§)</span></div>
                    <div class="girdi-etiket-cell separator geri-odemeli-only">â€” Kamu FiyatlarÄ± â€”</div>
                    <div class="girdi-etiket-cell geri-odemeli-only">Kamu PSF<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(KDV Dahil)</span></div>
                    <div class="girdi-etiket-cell geri-odemeli-only">Kamu PSF<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(KDV HariÃ§)</span></div>
                    <div class="girdi-etiket-cell geri-odemeli-only">Kamu DSF<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(KDV HariÃ§)</span></div>
                    <div class="girdi-etiket-cell separator">â€” SatÄ±ÅŸ Bilgileri â€”</div>
                    <div class="girdi-etiket-cell">SatÄ±ÅŸ Adedi</div>
                    <div class="girdi-etiket-cell">MF</div>
                    <div class="girdi-etiket-cell">SatÄ±ÅŸ ÅartlÄ± DSF</div>
                    <div class="girdi-etiket-cell separator">â€” Finansal â€”</div>
                    <div class="girdi-etiket-cell">SatÄ±ÅŸ Vadesi<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(gÃ¼n)</span></div>
                    <div class="girdi-etiket-cell">Ort. YÄ±llÄ±k Faiz<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(%)</span></div>
                    <div class="girdi-etiket-cell separator">â€” SÃ¼reler â€”</div>
                    <div class="girdi-etiket-cell">GÃ¼nlÃ¼k SatÄ±ÅŸ Adedi</div>
                    <div class="girdi-etiket-cell">TÃ¼ketim SÃ¼resi</div>
                    <div class="girdi-etiket-cell">Fatura SatÄ±ÅŸ SÃ¼resi</div>
                    <div class="girdi-etiket-cell geri-odemeli-only last-go">Geri Ã–deme SÃ¼resi<span style="display:block;font-size:9px;font-weight:400;text-transform:none;letter-spacing:0;margin-top:2px;margin-left:3px;">(gÃ¼n)</span></div>
                    <div class="girdi-etiket-cell last geri-odemsiz-last" style="display:none;">TÃ¼ketim SÃ¼resi</div>
                  </div>

                  <!-- BENÄ°M ÃœRÃœNÃœM SÃœTUNU -->
                  <div class="girdi-urun-col" id="girdi-col-u0">
                    <div class="girdi-input-cell baslik" style="flex-direction:row;align-items:center;justify-content:space-between;">
                      <div class="urun-baslik-isim" id="baslik-girdi-u0">ğŸ“¦ Benim ÃœrÃ¼nÃ¼m</div>
                      <div onclick="ekleRakip()" id="btn-ekle-rakip-1" class="urun-ekle-btn">+ Rakip</div>
                    </div>
                    <div class="girdi-input-cell referans">
                      <input type="text" id="u0-urun-adi" placeholder="" oninput="urunAdiGuncelle('u0', this.value)" style="width:100%;background:#fff;border:1px solid var(--border);border-radius:10px;padding:9px 12px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none;height:42px;">
                    </div>
                    <div class="girdi-input-cell referans geri-odemeli-only">
                      <select id="u0-urun-tipi" onchange="refUygulamaSecim(); hesaplaKamuDSF()">
                        <option value="" disabled selected></option>
                        <option value="fiyat_korumali">Fiyat KorumalÄ±</option>
                        <option value="esdegeri_olmayan">EÅŸdeÄŸeri Olmayan</option>
                        <option value="esdegerli_referans">EÅŸdeÄŸeri Olan</option>
                        <option value="enteral">Enteral Beslenme</option>
                      </select>
                    </div>
                    <div class="girdi-input-cell"><input type="number" id="u0-psf" placeholder="Ã¶rn. 200.00" step="0.01" oninput="psfDenKDVsiz()"></div>
                    <div class="girdi-input-cell"><input type="text" id="u0-psf-kdvsiz" placeholder="Otomatik" readonly></div>
                    <div class="girdi-input-cell"><input type="text" id="u0-dsf" placeholder="Otomatik" readonly class="dsf-input-otomatik" oninput="dsfManuelP('u0')"></div>
                    <div class="girdi-input-cell separator geri-odemeli-only"></div>
                    <div class="girdi-input-cell geri-odemeli-only"><input type="text" id="u0-kamu-psf" placeholder="Otomatik" readonly></div>
                    <div class="girdi-input-cell geri-odemeli-only"><input type="text" id="u0-kamu-psf-kdvsiz" placeholder="Otomatik" readonly></div>
                    <div class="girdi-input-cell geri-odemeli-only"><input type="text" id="u0-kamu-dsf" placeholder="Otomatik" readonly></div>
                    <div class="girdi-input-cell separator"></div>
                    <div class="girdi-input-cell"><input type="number" id="u0-satis-adet" placeholder="Ã¶rn. 100" step="1" oninput="hesaplaOTS(); hesaplaFISS(); hesaplaSatisSartliDSF();"></div>
                    <div class="girdi-input-cell"><input type="text" id="u0-mf" placeholder="Ã¶rn. 10" oninput="hesaplaOTS(); hesaplaSatisSartliDSF();"></div>
                    <div class="girdi-input-cell"><input type="text" id="u0-satis-sartli-dsf" placeholder="Otomatik" readonly></div>
                    <div class="girdi-input-cell separator"></div>
                    <div class="girdi-input-cell"><input type="number" id="u0-vade" placeholder="Ã¶rn. 90" step="1" oninput="hesaplaCiktilar();"></div>
                    <div class="girdi-input-cell"><input type="number" id="u0-faiz" placeholder="Ã¶rn. 45" step="0.01" oninput="hesaplaCiktilar();"></div>
                    <div class="girdi-input-cell separator"></div>
                    <div class="girdi-input-cell"><input type="number" id="u0-gunluk-satis" placeholder="Ã¶rn. 5" step="1" oninput="hesaplaOTS(); hesaplaFISS(); hesaplaCiktilar();"></div>
                    <div class="girdi-input-cell"><input type="number" id="u0-tuketim-sure" readonly placeholder="gÃ¼n"></div>
                    <div class="girdi-input-cell"><input type="number" id="u0-fatura-sure" readonly placeholder="gÃ¼n"></div>
                    <div class="girdi-input-cell geri-odemeli-only last-go">
                      <input type="text" inputmode="numeric" pattern="[0-9]*" id="u0-geri-odeme-sure-select" placeholder="gÃ¼n" list="geri-odeme-liste" oninput="hesaplaCiktilar();">
                      <datalist id="geri-odeme-liste">
                        <option value="45"><option value="60"><option value="75">
                        <option value="90"><option value="105"><option value="120">
                      </datalist>
                    </div>
                    <div class="girdi-input-cell last geri-odemsiz-last" style="display:none;"></div>
                  </div>
                  <!-- Rakip girdi sÃ¼tunlar JS ile buraya eklenir -->

                </div>
              </div>
            </div>
          </div>

          <!-- Ã‡IKTILAR -->
          <div class="inner-acc-item" id="acc-ciktilar">
            <div class="inner-acc-header" onclick="event.stopPropagation(); innerToggle('ciktilar')">
              <div class="acc-title">
                <h3 style="font-size:13px;letter-spacing:1.5px;color:#6b7280;">Ã‡IKTILAR</h3>
              </div>
              <div class="acc-chevron">â–¼</div>
            </div>
            <div class="inner-acc-body">
              <div class="tablo-scroll-wrap">
                <div class="cikti-tablo" id="cikti-tablo">

                  <!-- SOL SABÄ°T ETÄ°KET SÃœTUNU -->
                  <div class="cikti-etiket-col">
                    <div class="cikti-etiket-cell baslik cikti-row-baslik"></div>
                    <div class="cikti-etiket-cell cikti-row-alis">Toplam AlÄ±ÅŸ-SatÄ±ÅŸ KÃ¢rÄ±</div>
                    <div class="cikti-etiket-cell thick cikti-row-mf">Toplam MF KÃ¢rÄ±</div>
                    <div class="cikti-etiket-cell cikti-row-valor-t"><div>TÃ¼ketim SÃ¼resine GÃ¶re<br><strong>ValÃ¶r KÃ¢rÄ±</strong></div></div>
                    <div class="cikti-etiket-cell thick cikti-row-valor-f"><div>Fatura SÃ¼resine GÃ¶re<br><strong>ValÃ¶r KÃ¢rÄ±</strong></div></div>
                    <div class="cikti-etiket-cell cikti-row-toplam-t"><div>TÃ¼ketim SÃ¼resine GÃ¶re<br><strong>Toplam KÃ¢r</strong></div></div>
                    <div class="cikti-etiket-cell last cikti-row-toplam-f"><div>Fatura SÃ¼resine GÃ¶re<br><strong>Toplam KÃ¢r</strong></div></div>
                  </div>

                  <!-- BENÄ°M ÃœRÃœNÃœM Ã‡IKTI SÃœTUNU -->
                  <div class="cikti-urun-col" id="cikti-col-u0">
                    <div class="cikti-urun-baslik cikti-row-baslik">
                      <div class="cikti-urun-baslik-isim" id="baslik-cikti-u0">ğŸ“¦ Benim ÃœrÃ¼nÃ¼m</div>
                      <div class="cikti-kamu-elden-baslik">
                        <div>Kamu</div><div>Elden SatÄ±ÅŸ</div>
                      </div>
                    </div>
                    <div class="cikti-deger-cell cikti-row-alis">
                      <div class="cikti-kamu-wrap">
                        <input type="text" id="u0-alis-satis-kar-kamu" readonly class="cikti-input">
                        <input type="text" id="u0-alis-satis-kar-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                      <div class="cikti-elden-wrap">
                        <input type="text" id="u0-alis-satis-kar-elden" readonly class="cikti-input">
                        <input type="text" id="u0-alis-satis-kar-elden-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                    </div>
                    <div class="cikti-deger-cell span2 thick cikti-row-mf">
                      <div class="cikti-kamu-wrap">
                        <input type="text" id="u0-mf-kar-kamu" readonly class="cikti-input">
                        <input type="text" id="u0-mf-kar-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                    </div>
                    <div class="cikti-deger-cell span2 cikti-row-valor-t">
                      <div class="cikti-kamu-wrap">
                        <input type="text" id="u0-valor-tuketim-kamu" readonly class="cikti-input">
                        <input type="text" id="u0-valor-tuketim-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                    </div>
                    <div class="cikti-deger-cell span2 thick cikti-row-valor-f">
                      <div class="cikti-kamu-wrap">
                        <input type="text" id="u0-valor-geriodeme-kamu" readonly class="cikti-input">
                        <input type="text" id="u0-valor-geriodeme-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                    </div>
                    <div class="cikti-deger-cell cikti-row-toplam-t">
                      <div class="cikti-kamu-wrap">
                        <input type="text" id="u0-toplam-kar-tuketim-kamu" readonly class="cikti-input">
                        <input type="text" id="u0-toplam-kar-tuketim-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                      <div class="cikti-elden-wrap">
                        <input type="text" id="u0-toplam-kar-tuketim-elden" readonly class="cikti-input">
                        <input type="text" id="u0-toplam-kar-tuketim-elden-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                    </div>
                    <div class="cikti-deger-cell last cikti-row-toplam-f">
                      <div class="cikti-kamu-wrap">
                        <input type="text" id="u0-toplam-kar-geriodeme-kamu" readonly class="cikti-input">
                        <input type="text" id="u0-toplam-kar-geriodeme-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                      <div class="cikti-elden-wrap">
                        <input type="text" id="u0-toplam-kar-geriodeme-elden" readonly class="cikti-input">
                        <input type="text" id="u0-toplam-kar-geriodeme-elden-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
                      </div>
                    </div>
                  </div>
                  <!-- Rakip Ã§Ä±ktÄ± sÃ¼tunlar JS ile buraya eklenir -->

                </div>
              </div>
            </div>
          </div>

    </div>
  </div>
</div>

<script>
function toggle(id) { document.getElementById('acc-' + id).classList.toggle('open'); }
function innerToggle(id) { document.getElementById('acc-' + id).classList.toggle('open'); }

function fmt(n) {
  return new Intl.NumberFormat('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n) + ' â‚º';
}
function v(id) {
  const el = document.getElementById(id);
  if (!el) return 0;
  return parseFloat(el.value.replace('â‚º ', '').replace('â‚º', '').replace(/\./g, '').replace(',', '.')) || 0;
}
function vi(id) { return parseInt(document.getElementById(id).value) || 0; }

function setPCT(id, kar, maliyet) {
  const el = document.getElementById(id);
  if (!el) return;
  if (kar !== '' && maliyet) {
    const pct = (parseFloat(kar) / maliyet) * 100;
    el.value = '%' + pct.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    el.style.color = pct < 0 ? '#e63946' : '#6366f1';
    el.style.borderColor = pct < 0 ? '#e63946' : '#6366f1';
    el.style.background = pct < 0 ? '#fff5f5' : '#f0f4ff';
  } else { el.value = ''; }
}

function setTL(id, val) {
  const el = document.getElementById(id);
  if (!el) return;
  if (val !== '' && val !== null && !isNaN(val)) {
    const num = parseFloat(val);
    el.value = 'â‚º ' + num.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const isValor = id.includes('valor') || id.includes('toplam-kar');
    if (isValor && num < 0) {
      el.style.color = '#e63946'; el.style.borderColor = '#e63946'; el.style.background = '#fff5f5';
    } else {
      el.style.color = '#007d0c'; el.style.borderColor = '#007d0c'; el.style.background = '#f0fdf8';
    }
  } else {
    el.value = '';
    el.style.color = '#007d0c'; el.style.borderColor = '#007d0c'; el.style.background = '#f0fdf8';
  }
}

function parseTL(id) {
  const el = document.getElementById(id);
  if (!el) return 0;
  return parseFloat(el.value.replace('â‚º ', '').replace('â‚º', '').replace(/\./g, '').replace(',', '.')) || 0;
}
function clearEl(id) { const el = document.getElementById(id); if (el) el.value = ''; }

// â”€â”€ RAKÄ°P EKLE / KALDIR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let rakipSayisi = 0;

function ekleRakip() {
  if (rakipSayisi >= 2) return;
  rakipSayisi++;
  const p = 'u' + rakipSayisi;
  const isim = rakipSayisi === 1 ? 'Rakip ÃœrÃ¼n 1' : 'Rakip ÃœrÃ¼n 2';
  const renk = rakipSayisi === 1 ? 'rakip-1' : 'rakip-2';

  if (rakipSayisi === 1) {
    const b = document.getElementById('btn-ekle-rakip-1');
    if (b) b.style.display = 'none';
  }
  if (rakipSayisi === 2) {
    const bwrap = document.getElementById('btn-wrap-u1');
    if (bwrap) bwrap.style.display = 'none';
  }

  const girdiTablo = document.getElementById('girdi-tablo');
  const col = document.createElement('div');
  col.className = 'girdi-urun-col ' + renk;
  col.id = 'girdi-col-' + p;
  col.innerHTML = girdiSutunHTML(p, isim, renk);
  girdiTablo.appendChild(col);

  const ciktiTablo = document.getElementById('cikti-tablo');
  const ciktiCol = document.createElement('div');
  ciktiCol.className = 'cikti-urun-col ' + renk;
  ciktiCol.id = 'cikti-col-' + p;
  ciktiCol.innerHTML = ciktiSutunHTML(p, isim, renk);
  ciktiTablo.appendChild(ciktiCol);
}

function kaldirRakip(p) {
  const num = parseInt(p.replace('u', ''));
  ['girdi-col-', 'cikti-col-'].forEach(pre => {
    const el = document.getElementById(pre + p); if (el) el.remove();
  });
  if (num === 1) {
    ['girdi-col-u2', 'cikti-col-u2'].forEach(id => { const el = document.getElementById(id); if (el) el.remove(); });
    rakipSayisi = 0;
  } else {
    rakipSayisi = 1;
  }
  const b1 = document.getElementById('btn-ekle-rakip-1');
  if (b1) b1.style.display = '';
}

function girdiSutunHTML(p, isim, renk) {
  const ekleBtn = rakipSayisi === 1
    ? `<div onclick="ekleRakip()" id="btn-ekle-rakip-2" class="urun-ekle-btn">+ Rakip</div>` : '';
  const defaultIsim = p === 'u1' ? 'Rakip ÃœrÃ¼n 1' : 'Rakip ÃœrÃ¼n 2';
  return `
    <div class="girdi-input-cell baslik ${renk}" style="flex-direction:row;align-items:center;justify-content:space-between;">
      <div class="urun-baslik-isim ${renk}" id="baslik-girdi-${p}">ğŸ·ï¸ ${isim}</div>
      <div style="display:flex;align-items:center;gap:6px;">
        <div id="btn-wrap-${p}">${ekleBtn}</div>
        <div onclick="kaldirRakip('${p}')" class="urun-kapat-btn">âœ•</div>
      </div>
    </div>
    <div class="girdi-input-cell referans">
      <input type="text" id="${p}-urun-adi" placeholder="" oninput="urunAdiGuncelle('${p}', this.value)" style="width:100%;background:#fff;border:1px solid var(--border);border-radius:10px;padding:9px 12px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none;height:42px;">
    </div>
    <div class="girdi-input-cell referans geri-odemeli-only">
      <select id="${p}-urun-tipi" onchange="refUygulamaSecimP('${p}'); hesaplaKamuDSFP('${p}')">
        <option value="" disabled selected></option>
        <option value="fiyat_korumali">Fiyat KorumalÄ±</option>
        <option value="esdegeri_olmayan">EÅŸdeÄŸeri Olmayan</option>
        <option value="esdegerli_referans">EÅŸdeÄŸeri Olan</option>
        <option value="enteral">Enteral Beslenme</option>
      </select>
    </div>
    <div class="girdi-input-cell"><input type="number" id="${p}-psf" placeholder="Ã¶rn. 200.00" step="0.01" oninput="psfDenKDVsizP('${p}')"></div>
    <div class="girdi-input-cell"><input type="text" id="${p}-psf-kdvsiz" placeholder="Otomatik" readonly></div>
    <div class="girdi-input-cell"><input type="text" id="${p}-dsf" placeholder="Otomatik" readonly class="dsf-input-otomatik" oninput="dsfManuelP('${p}')"></div>
    <div class="girdi-input-cell separator geri-odemeli-only"></div>
    <div class="girdi-input-cell geri-odemeli-only"><input type="text" id="${p}-kamu-psf" placeholder="Otomatik" readonly></div>
    <div class="girdi-input-cell geri-odemeli-only"><input type="text" id="${p}-kamu-psf-kdvsiz" placeholder="Otomatik" readonly></div>
    <div class="girdi-input-cell geri-odemeli-only"><input type="text" id="${p}-kamu-dsf" placeholder="Otomatik" readonly></div>
    <div class="girdi-input-cell separator"></div>
    <div class="girdi-input-cell"><input type="number" id="${p}-satis-adet" placeholder="Ã¶rn. 100" step="1" oninput="hesaplaOTSP('${p}'); hesaplaFISSP('${p}'); hesaplaSatisSartliDSFP('${p}');"></div>
    <div class="girdi-input-cell"><input type="text" id="${p}-mf" placeholder="Ã¶rn. 10" oninput="hesaplaOTSP('${p}'); hesaplaSatisSartliDSFP('${p}');"></div>
    <div class="girdi-input-cell"><input type="text" id="${p}-satis-sartli-dsf" placeholder="Otomatik" readonly></div>
    <div class="girdi-input-cell separator"></div>
    <div class="girdi-input-cell"><input type="number" id="${p}-vade" placeholder="Ã¶rn. 90" step="1" oninput="hesaplaCiktilarP('${p}');"></div>
    <div class="girdi-input-cell"><input type="number" id="${p}-faiz" placeholder="Ã¶rn. 45" step="0.01" oninput="hesaplaCiktilarP('${p}');"></div>
    <div class="girdi-input-cell separator"></div>
    <div class="girdi-input-cell"><input type="number" id="${p}-gunluk-satis" placeholder="Ã¶rn. 5" step="1" oninput="hesaplaOTSP('${p}'); hesaplaFISSP('${p}'); hesaplaCiktilarP('${p}');"></div>
    <div class="girdi-input-cell"><input type="number" id="${p}-tuketim-sure" readonly placeholder="gÃ¼n"></div>
    <div class="girdi-input-cell"><input type="number" id="${p}-fatura-sure" readonly placeholder="gÃ¼n"></div>
    <div class="girdi-input-cell geri-odemeli-only last-go"><input type="text" inputmode="numeric" id="${p}-geri-odeme-sure-select" placeholder="gÃ¼n" list="geri-odeme-liste" oninput="hesaplaCiktilarP('${p}');"></div>
    <div class="girdi-input-cell last geri-odemsiz-last" style="display:none;"></div>
  `;
}

function ciktiSutunHTML(p, isim, renk) {
  return `
    <div class="cikti-urun-baslik ${renk} cikti-row-baslik">
      <div class="cikti-urun-baslik-isim ${renk}" id="baslik-cikti-${p}">ğŸ·ï¸ ${isim}</div>
      <div class="cikti-kamu-elden-baslik"><div>Kamu</div><div>Elden SatÄ±ÅŸ</div></div>
    </div>
    <div class="cikti-deger-cell cikti-row-alis">
      <div class="cikti-kamu-wrap">
        <input type="text" id="${p}-alis-satis-kar-kamu" readonly class="cikti-input">
        <input type="text" id="${p}-alis-satis-kar-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
      <div class="cikti-elden-wrap">
        <input type="text" id="${p}-alis-satis-kar-elden" readonly class="cikti-input">
        <input type="text" id="${p}-alis-satis-kar-elden-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
    </div>
    <div class="cikti-deger-cell span2 thick cikti-row-mf">
      <div class="cikti-kamu-wrap">
        <input type="text" id="${p}-mf-kar-kamu" readonly class="cikti-input">
        <input type="text" id="${p}-mf-kar-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
    </div>
    <div class="cikti-deger-cell span2 cikti-row-valor-t">
      <div class="cikti-kamu-wrap">
        <input type="text" id="${p}-valor-tuketim-kamu" readonly class="cikti-input">
        <input type="text" id="${p}-valor-tuketim-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
    </div>
    <div class="cikti-deger-cell span2 thick cikti-row-valor-f">
      <div class="cikti-kamu-wrap">
        <input type="text" id="${p}-valor-geriodeme-kamu" readonly class="cikti-input">
        <input type="text" id="${p}-valor-geriodeme-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
    </div>
    <div class="cikti-deger-cell cikti-row-toplam-t">
      <div class="cikti-kamu-wrap">
        <input type="text" id="${p}-toplam-kar-tuketim-kamu" readonly class="cikti-input">
        <input type="text" id="${p}-toplam-kar-tuketim-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
      <div class="cikti-elden-wrap">
        <input type="text" id="${p}-toplam-kar-tuketim-elden" readonly class="cikti-input">
        <input type="text" id="${p}-toplam-kar-tuketim-elden-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
    </div>
    <div class="cikti-deger-cell last cikti-row-toplam-f">
      <div class="cikti-kamu-wrap">
        <input type="text" id="${p}-toplam-kar-geriodeme-kamu" readonly class="cikti-input">
        <input type="text" id="${p}-toplam-kar-geriodeme-kamu-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
      <div class="cikti-elden-wrap">
        <input type="text" id="${p}-toplam-kar-geriodeme-elden" readonly class="cikti-input">
        <input type="text" id="${p}-toplam-kar-geriodeme-elden-pct" readonly class="cikti-pct" placeholder="KÃ¢r/Maliyet">
      </div>
    </div>
  `;
}

// â”€â”€ PREFIX'LÄ° HESAPLAMA FONKSÄ°YONLARI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function psfDenKDVsizP(p) {
  const psf = parseFloat(document.getElementById(p+'-psf').value) || 0;
  if (psf) {
    const kdvsiz = psf / 1.10;
    setTL(p+'-psf-kdvsiz', kdvsiz);
    if (!modGeriOdemsiz) hesaplaDSFP(p, kdvsiz);
  } else {
    [p+'-psf-kdvsiz',p+'-dsf',p+'-kamu-psf',p+'-kamu-psf-kdvsiz',p+'-kamu-dsf'].forEach(id => {
      const el = document.getElementById(id); if (el) el.value = '';
    });
  }
}

function hesaplaDSFP(p, kdvsiz) {
  const K1 = 383.43, K2 = 768.03;
  let dsf = kdvsiz <= K1 ? kdvsiz / 1.28
    : kdvsiz <= K2 ? (K1/1.28) + ((kdvsiz-K1)/1.18)
    : (K1/1.28) + ((K2-K1)/1.18) + ((kdvsiz-K2)/1.13);
  setTL(p+'-dsf', dsf);
  hesaplaKamuDSFP(p, dsf);
}

function refUygulamaSecimP(p) {
  const tip = document.getElementById(p+'-urun-tipi').value;
  const satir = document.getElementById(p+'-referans-tipi-satir');
  if (satir) satir.style.display = tip === 'fiyat_korumali' ? 'block' : 'none';
  if (tip !== 'fiyat_korumali') { const el = document.getElementById(p+'-referans-tipi'); if (el) el.value = ''; }
}

function hesaplaKamuDSFP(p, dsfParam) {
  const dsf = dsfParam || parseTL(p+'-dsf');
  const tip = document.getElementById(p+'-urun-tipi').value;
  const refTipEl = document.getElementById(p+'-referans-tipi');
  const refTip = refTipEl ? refTipEl.value : '';
  if (!dsf || !tip) return;
  let oran = 0;
  if (dsf <= 45.63) { oran = 0; }
  else if (tip === 'fiyat_korumali') { oran = dsf<=87.34?0 : dsf<=131.60?10 : (refTip==='yok'?40:28); }
  else if (tip === 'esdegeri_olmayan') { oran = dsf<=87.34?10 : dsf<=131.60?31 : 41; }
  else if (tip === 'esdegerli_referans') { oran = dsf<=87.34?10 : dsf<=131.60?18 : 28; }
  else if (tip === 'enteral') { oran = dsf<=87.34?11 : dsf<=131.60?31 : 41; }
  const kamuDsf = dsf * (1 - oran/100);
  setTL(p+'-kamu-dsf', kamuDsf);
  const eczaciKar = kamuDsf<=383.43 ? 0.28 : kamuDsf<=768.03 ? 0.18 : 0.13;
  const kamuPsfKdvsiz = kamuDsf * (1 + eczaciKar);
  setTL(p+'-kamu-psf-kdvsiz', kamuPsfKdvsiz);
  setTL(p+'-kamu-psf', kamuPsfKdvsiz * 1.10);
  hesaplaSatisSartliDSFP(p);
}

function hesaplaSatisSartliDSFP(p) {
  const satisAdet = parseFloat(document.getElementById(p+'-satis-adet').value) || 0;
  const mf        = parseFloat(document.getElementById(p+'-mf').value) || 0;
  const dsf       = modGeriOdemsiz ? (parseFloat(document.getElementById(p+'-dsf').value) || 0) : parseTL(p+'-kamu-dsf');
  if (satisAdet && dsf) {
    setTL(p+'-satis-sartli-dsf', (satisAdet * dsf) / (satisAdet + mf));
  } else { const el = document.getElementById(p+'-satis-sartli-dsf'); if (el) el.value = ''; }
  hesaplaCiktilarP(p);
}

function hesaplaOTSP(p) {
  const satisAdet   = parseFloat(document.getElementById(p+'-satis-adet').value) || 0;
  const mf          = parseFloat(document.getElementById(p+'-mf').value) || 0;
  const gunlukSatis = parseFloat(document.getElementById(p+'-gunluk-satis').value) || 0;
  const el = document.getElementById(p+'-tuketim-sure');
  if (satisAdet && gunlukSatis) {
    const ots = (satisAdet + mf) / gunlukSatis;
    el.value = (ots % 1) >= 0.5 ? Math.ceil(ots) : Math.floor(ots);
  } else { el.value = ''; }
  hesaplaCiktilarP(p);
}

function hesaplaFISSP(p) {
  const satisSartliDsf = parseTL(p+'-satis-sartli-dsf');
  const satisAdet      = parseFloat(document.getElementById(p+'-satis-adet').value) || 0;
  const mf             = parseFloat(document.getElementById(p+'-mf').value) || 0;
  const gunlukSatis    = parseFloat(document.getElementById(p+'-gunluk-satis').value) || 0;
  const psfKdvsizFiss  = parseTL(p+'-psf-kdvsiz');
  const el = document.getElementById(p+'-fatura-sure');
  if (satisSartliDsf && satisAdet && gunlukSatis && psfKdvsizFiss) {
    const fiss = ((satisAdet + mf) * satisSartliDsf) / (gunlukSatis * psfKdvsizFiss);
    el.value = (fiss % 1) >= 0.5 ? Math.ceil(fiss) : Math.floor(fiss);
  } else { el.value = ''; }
}

function hesaplaCiktilarP(p) {
  const psfKdvsiz      = parseTL(p+'-psf-kdvsiz');
  const satisSartliDsf = parseTL(p+'-satis-sartli-dsf');
  const mf             = parseFloat(document.getElementById(p+'-mf').value) || 0;
  const satisAdet      = parseFloat(document.getElementById(p+'-satis-adet').value) || 0;
  const gunlukSatis    = parseFloat(document.getElementById(p+'-gunluk-satis').value) || 0;
  const dsf            = parseTL(p+'-dsf');

  psfKdvsiz && dsf ? setTL(p+'-alis-satis-kar-kamu',  (psfKdvsiz-dsf)*satisAdet) : clearEl(p+'-alis-satis-kar-kamu');
  psfKdvsiz && dsf ? setTL(p+'-alis-satis-kar-elden', (psfKdvsiz-dsf)*satisAdet) : clearEl(p+'-alis-satis-kar-elden');
  mf && psfKdvsiz ? setTL(p+'-mf-kar-kamu', psfKdvsiz*mf) : clearEl(p+'-mf-kar-kamu');

  const vade          = parseFloat(document.getElementById(p+'-vade').value) || 0;
  const faiz          = parseFloat(document.getElementById(p+'-faiz').value) || 0;
  const tuketimSure   = parseFloat(document.getElementById(p+'-tuketim-sure').value) || 0;
  const geriOdemeSure = parseFloat(document.getElementById(p+'-geri-odeme-sure-select').value) || 0;
  const faturaSure    = parseFloat(document.getElementById(p+'-fatura-sure').value) || 0;

  if (satisAdet && satisSartliDsf && faiz && vade && tuketimSure)
    setTL(p+'-valor-tuketim-kamu', (satisSartliDsf*(satisAdet+mf))*(vade-tuketimSure)*faiz/36500);
  else clearEl(p+'-valor-tuketim-kamu');

  if (satisSartliDsf && faiz && vade && tuketimSure && faturaSure && gunlukSatis)
    setTL(p+'-valor-geriodeme-kamu', (satisSartliDsf*(faturaSure*gunlukSatis))*(vade-tuketimSure)*faiz/36500);
  else clearEl(p+'-valor-geriodeme-kamu');

  const aK  = parseTL(p+'-alis-satis-kar-kamu');
  const aE  = parseTL(p+'-alis-satis-kar-elden');
  const mfK = parseTL(p+'-mf-kar-kamu');
  const vT  = parseTL(p+'-valor-tuketim-kamu');
  const vF  = parseTL(p+'-valor-geriodeme-kamu');
  const mal = satisSartliDsf * (satisAdet + mf);

  // Fatura sÃ¼resinde satÄ±lan adet = faturaSure Ã— gunlukSatis
  const faturaAdet = faturaSure * gunlukSatis;
  const faturaKar  = faturaAdet * (psfKdvsiz - satisSartliDsf);

  setTL(p+'-toplam-kar-tuketim-kamu',    aK+mfK+vT);
  setTL(p+'-toplam-kar-tuketim-elden',   aE+mfK+vT);
  setTL(p+'-toplam-kar-geriodeme-kamu',  faturaKar+vF);
  setTL(p+'-toplam-kar-geriodeme-elden', faturaKar+vF);

  setPCT(p+'-alis-satis-kar-kamu-pct',        aK,           mal);
  setPCT(p+'-alis-satis-kar-elden-pct',       aE,           mal);
  setPCT(p+'-mf-kar-kamu-pct',               mfK,          mal);
  setPCT(p+'-valor-tuketim-kamu-pct',        vT,           mal);
  setPCT(p+'-valor-geriodeme-kamu-pct',      vF,           mal);
  setPCT(p+'-toplam-kar-tuketim-kamu-pct',   aK+mfK+vT,    mal);
  setPCT(p+'-toplam-kar-tuketim-elden-pct',  aE+mfK+vT,    mal);
  setPCT(p+'-toplam-kar-geriodeme-kamu-pct', faturaKar+vF,  mal);
  setPCT(p+'-toplam-kar-geriodeme-elden-pct',faturaKar+vF,  mal);
}

// â”€â”€ ÃœRÃœN ADI GÃœNCELLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const defaultIsimler = { 'u0': 'ğŸ“¦ Benim ÃœrÃ¼nÃ¼m', 'u1': 'ğŸ·ï¸ Rakip ÃœrÃ¼n 1', 'u2': 'ğŸ·ï¸ Rakip ÃœrÃ¼n 2' };

function urunAdiGuncelle(p, deger) {
  const isim = deger.trim() || defaultIsimler[p];
  // Girdiler baÅŸlÄ±ÄŸÄ±
  const girdiBaslik = document.getElementById('baslik-girdi-' + p);
  if (girdiBaslik) girdiBaslik.textContent = isim;
  // Ã‡Ä±ktÄ±lar baÅŸlÄ±ÄŸÄ±
  const ciktiBaslik = document.getElementById('baslik-cikti-' + p);
  if (ciktiBaslik) ciktiBaslik.textContent = isim;
}

// â”€â”€ TOGGLE MOD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let modGeriOdemsiz = false;

function dsfAyarla(geriOdemsiz) {
  ['u0','u1','u2'].forEach(p => {
    const el = document.getElementById(p + '-dsf');
    if (!el) return;
    if (geriOdemsiz) {
      el.type = 'number';
      el.step = '0.01';
      el.removeAttribute('readonly');
      el.classList.remove('dsf-input-otomatik');
      el.classList.add('dsf-input-manuel');
      el.placeholder = 'Ã¶rn. 150.00';
      el.value = '';
    } else {
      el.type = 'text';
      el.removeAttribute('step');
      el.setAttribute('readonly', true);
      el.classList.remove('dsf-input-manuel');
      el.classList.add('dsf-input-otomatik');
      el.placeholder = 'Otomatik';
      el.value = '';
    }
  });
}

function dsfManuelP(p) {
  // Geri Ã¶demesiz modda DSF manuel girildi â€” aÅŸaÄŸÄ± hesaplamalarÄ± tetikle
  if (!modGeriOdemsiz) return;
  hesaplaSatisSartliDSFP(p);
  hesaplaCiktilarP(p);
}

function toggleMod() {
  modGeriOdemsiz = !modGeriOdemsiz;
  const knob = document.getElementById('toggle-knob');
  const lblGO = document.getElementById('lbl-geri-odemeli');
  const lblGOS = document.getElementById('lbl-geri-odemsiz');
  const baslik = document.getElementById('acc-main-baslik');
  if (modGeriOdemsiz) {
    document.body.classList.add('mod-geri-odemsiz');
    knob.style.left = '29px';
    lblGO.style.color = '#b0b8c8';
    lblGOS.style.color = '#007d0c';
    if (baslik) baslik.textContent = 'Geri Ã–demesiz ÃœrÃ¼nler Ä°Ã§in Ticari Avantaj Hesaplama';
  } else {
    document.body.classList.remove('mod-geri-odemsiz');
    knob.style.left = '3px';
    lblGO.style.color = '#007d0c';
    lblGOS.style.color = '#b0b8c8';
    if (baslik) baslik.textContent = 'Geri Ã–demeli ÃœrÃ¼nler Ä°Ã§in Ticari Avantaj Hesaplama';
  }
  dsfAyarla(modGeriOdemsiz);
  temizle();
}

// â”€â”€ TEMÄ°ZLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function temizle() {
  const kapsam = document;
  kapsam.querySelectorAll('input:not([readonly]), select').forEach(el => {
    if (el.tagName === 'SELECT') el.selectedIndex = 0;
    else el.value = '';
  });
  // Readonly (otomatik) alanlarÄ± da temizle
  kapsam.querySelectorAll('input[readonly]').forEach(el => {
    el.value = '';
    el.style.color = '#007d0c';
    el.style.borderColor = '#007d0c';
    el.style.background = '#f0fdf8';
  });
  // PCT alanlarÄ±nÄ± temizle
  kapsam.querySelectorAll('.cikti-pct').forEach(el => {
    el.value = '';
    el.style.color = '#6366f1';
    el.style.borderColor = '#6366f1';
    el.style.background = '#f0f4ff';
  });
  // BaÅŸlÄ±klarÄ± default'a dÃ¶ndÃ¼r
  ['u0','u1','u2'].forEach(p => {
    const defaults = { 'u0': 'ğŸ“¦ Benim ÃœrÃ¼nÃ¼m', 'u1': 'ğŸ·ï¸ Rakip ÃœrÃ¼n 1', 'u2': 'ğŸ·ï¸ Rakip ÃœrÃ¼n 2' };
    const g = document.getElementById('baslik-girdi-' + p);
    const c = document.getElementById('baslik-cikti-' + p);
    if (g) g.textContent = defaults[p];
    if (c) c.textContent = defaults[p];
  });
}

// â”€â”€ u0 wrapper'lar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function psfDenKDVsiz()          { psfDenKDVsizP('u0'); }
function hesaplaDSF(k)           { hesaplaDSFP('u0', k); }
function refUygulamaSecim()      { refUygulamaSecimP('u0'); }
function hesaplaKamuDSF(d)       { hesaplaKamuDSFP('u0', d); }
function hesaplaSatisSartliDSF() { hesaplaSatisSartliDSFP('u0'); }
function hesaplaOTS()            { hesaplaOTSP('u0'); }
function hesaplaFISS()           { hesaplaFISSP('u0'); }
function hesaplaCiktilar()       { hesaplaCiktilarP('u0'); }
</script>
</body>
</html>
