<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eczanede Üstünlük — Karlılık Hesaplama</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --red: #e63946;
  --green: #00a672;
  --bg: #ffffff;
  --surface: #f5f7fa;
  --border: #dde1ea;
  --text: #1a1f2e;
  --muted: #6b7280;
  --light: #f9fafb;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  min-height: 100vh;
  padding: 40px 20px 80px;
}

.container { max-width: 860px; margin: 0 auto; }

header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 40px;
}

.eczane-logo {
  width: 58px; height: 58px;
  background: var(--red);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 4px 16px rgba(230,57,70,0.25);
}
.eczane-logo span {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 38px; color: #fff; line-height: 1;
}

.header-text h1 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(28px, 5vw, 48px);
  letter-spacing: 2px; line-height: 1;
}
.header-text h1 span { color: var(--red); }
.header-text p { margin-top: 5px; color: var(--muted); font-size: 13px; }

/* ACCORDION */
.accordion { display: flex; flex-direction: column; gap: 16px; }

.acc-item {
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
}

.acc-header {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px 24px;
  cursor: pointer;
  user-select: none;
  transition: background 0.15s;
  background: var(--surface);
}

.acc-header:hover { background: #eef1f6; }

.acc-icon {
  width: 44px; height: 44px;
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px; flex-shrink: 0;
}

.acc-icon.geri-odemeli { background: rgba(230,57,70,0.1); }
.acc-icon.geri-odemsiz { background: rgba(0,166,114,0.1); }

.acc-title {
  flex: 1;
}
.acc-title h3 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 20px; letter-spacing: 1px;
}
.acc-title p { font-size: 12px; color: var(--muted); margin-top: 2px; }

.acc-chevron {
  font-size: 18px; color: var(--muted);
  transition: transform 0.25s;
}
.acc-item.open .acc-chevron { transform: rotate(180deg); }

.acc-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}
.acc-item.open .acc-body { max-height: 2000px; }

.acc-content { padding: 24px; border-top: 1px solid var(--border); }

/* FORM GRID */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
}

@media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }

/* ── RESPONSIVE ─────────────────────────────────────────── */

/* Tablet (768px altı) */
@media (max-width: 768px) {
  .container { padding: 12px; }
  .acc-header { padding: 14px 16px; }
  .field input, .field select { font-size: 13px; height: 40px; padding: 9px 12px; }
  .cikti-input { width: 100%; font-size: 12px; }

  /* 3'lü ve 4'lü grid'leri 2'ye indir */
  .field.full [style*="grid-template-columns:1fr 1fr 1fr"],
  div[style*="grid-template-columns:1fr 1fr 1fr"] { grid-template-columns: 1fr 1fr !important; }
  div[style*="grid-template-columns:1fr 1fr 1fr 1fr"] { grid-template-columns: 1fr 1fr !important; }
}

/* Mobil (480px altı) */
@media (max-width: 480px) {
  .container { padding: 8px; }
  .acc-header { padding: 12px 14px; }
  h1 { font-size: 28px !important; }

  /* Tüm çoklu grid'leri tek kolona indir */
  div[style*="grid-template-columns:1fr 1fr 1fr"],
  div[style*="grid-template-columns:1fr 1fr 1fr 1fr"],
  div[style*="grid-template-columns:1fr 1fr"] { grid-template-columns: 1fr !important; }

  /* Çıktılar grid'i */
  .ciktilar-grid { grid-template-columns: 1fr !important; }
  .ciktilar-grid > div { border-right: none !important; border-bottom: 1px solid var(--border); }

  /* Çıktılar tek grid */
  div[style*="grid-template-columns:auto 1fr 1fr"] {
    grid-template-columns: 1fr !important;
  }
  div[style*="grid-template-columns:auto 1fr 1fr"] > div[style*="display:contents"] > div {
    border-right: none !important;
    border-left: none !important;
  }

  .cikti-input { width: 100%; font-size: 12px; }
  .field input, .field select { font-size: 13px; }
}

/* Küçük mobil (360px altı) */
@media (max-width: 360px) {
  h1 { font-size: 24px !important; }
  .field label { font-size: 10px; }
  .field input, .field select { font-size: 12px; height: 38px; }
}

@media (max-width: 640px) {
  .ciktilar-ust { grid-template-columns: 1fr !important; }
  .ciktilar-ust > div:first-child { border-right: none !important; border-bottom: 1px solid var(--border); }
  .ciktilar-alt { grid-template-columns: 1fr !important; }
  .ciktilar-alt-etiket { border-right: none !important; border-bottom: none !important; font-weight:600; }
  .ciktilar-alt-kamu { border-right: none !important; }
  .ciktilar-alt-satir-1 > div { border-bottom: 1px dashed var(--border); }
  .ciktilar-alt-satir-2 > div { border-bottom: none; }
}

.form-grid .full { grid-column: 1 / -1; }

.field label {
  display: block;
  font-size: 11px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1.2px;
  color: var(--muted); margin-bottom: 6px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

.field label .hint {
  font-size: 10px; font-weight: 400;
  text-transform: none; letter-spacing: 0;
  color: #9ca3af; margin-left: 4px;
}

.field input, .field select {
  width: 100%;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 11px 14px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px; outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
  height: 44px;
}

.field input:focus, .field select:focus {
  border-color: var(--red);
  box-shadow: 0 0 0 3px rgba(230,57,70,0.1);
}

.field input::placeholder { color: #c0c8d8; }

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
input[type=number] { -moz-appearance: textfield; }

.field select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b7280' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  padding-right: 36px; cursor: pointer;
}

.inner-acc-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}
.inner-acc-item.open .inner-acc-body { max-height: 2000px; }
.inner-acc-item.open .acc-chevron { transform: rotate(180deg); }
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 8px; align-items: center;
}
.mf-sep { text-align: center; font-size: 18px; color: var(--muted); font-weight: 600; padding-top: 22px; }

.kki-badge {
  grid-column: 1 / -1;
  background: linear-gradient(135deg, #fff5f5, #ffe8e8);
  border: 1.5px solid rgba(230,57,70,0.3);
  border-radius: 12px;
  padding: 14px 18px;
  display: flex;
  align-items: center;
  gap: 16px;
}
.kki-badge-label {
  font-size: 10px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1px;
  color: var(--red); white-space: nowrap;
}
.kki-badge-value {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 32px; color: var(--red); line-height: 1;
  white-space: nowrap;
}
.kki-badge-desc {
  font-size: 11px; color: var(--muted); line-height: 1.5;
}

.ref-btn {
  background: #fff;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  padding: 8px 14px;
  font-family: 'DM Sans', sans-serif;
  font-size: 12px; font-weight: 600;
  color: var(--text); cursor: pointer;
  transition: border-color 0.2s, background 0.2s;
}
.ref-btn:hover { border-color: var(--red); background: #fff5f5; color: var(--red); }

/* CALC BUTTON */
.btn-calc {
  width: 100%;
  background: var(--red);
  color: #fff; border: none;
  border-radius: 12px; padding: 14px;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 20px; letter-spacing: 1.5px;
  cursor: pointer;
  transition: background 0.2s, transform 0.15s, box-shadow 0.15s;
}
.btn-calc:hover {
  background: #c1121f;
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(230,57,70,0.25);
}
.btn-calc.green { background: var(--green); }
.btn-calc.green:hover { background: #008f62; box-shadow: 0 6px 20px rgba(0,166,114,0.25); }

/* RESULTS */
.results {
  margin-top: 24px;
  display: none;
}
.results.show { display: block; }

.results-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 16px; letter-spacing: 1px;
  color: var(--muted); margin-bottom: 14px;
  text-transform: uppercase;
}

.result-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

@media (max-width: 600px) { .result-grid { grid-template-columns: 1fr 1fr; } }

.cikti-satir {
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:12px;
  gap:12px;
}
.cikti-label {
  font-size:13px;
  color:var(--text);
  white-space:nowrap;
}
.cikti-input {
  background:#f0fdf8;
  border:1px solid #00a672;
  color:#00a672;
  font-weight:600;
  border-radius:8px;
  padding:8px 12px;
  font-size:13px;
  text-align:center;
  width:120px;
  outline:none;
}

/* Tüm readonly/otomatik inputlarda merkez hizalama */
.field input[readonly] {
  text-align:center;
}

.result-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 14px 16px;
}

.result-card .rc-label {
  font-size: 10px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1px;
  color: var(--muted); margin-bottom: 6px;
}

.result-card .rc-value {
  font-size: 20px; font-weight: 600;
  color: var(--text); line-height: 1.2;
}

.result-card .rc-value.positive { color: var(--green); }
.result-card .rc-value.negative { color: var(--red); }
.result-card .rc-value.accent { color: var(--red); }

.result-card .rc-sub {
  font-size: 11px; color: var(--muted); margin-top: 3px;
}

.valör-box {
  background: linear-gradient(135deg, #f0fdf8, #e6f7f2);
  border: 1px solid rgba(0,166,114,0.25);
  border-radius: 12px;
  padding: 16px 20px;
  display: flex; align-items: center; gap: 16px;
}

.valör-box .vb-icon { font-size: 28px; }
.valör-box .vb-text { flex: 1; }
.valör-box .vb-label { font-size: 11px; font-weight: 600; color: var(--green); text-transform: uppercase; letter-spacing: 1px; }
.valör-box .vb-value { font-size: 22px; font-weight: 600; color: var(--text); margin-top: 2px; }
.valör-box .vb-desc { font-size: 12px; color: var(--muted); margin-top: 3px; line-height: 1.5; }

.divider { height: 1px; background: var(--border); margin: 20px 0; }

.total-box {
  background: var(--text);
  border-radius: 12px;
  padding: 18px 20px;
  display: flex; justify-content: space-between; align-items: center;
}
.total-box .tb-label {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 18px; letter-spacing: 1px; color: #fff;
}
.total-box .tb-value {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 28px; color: #4ade80;
}
</style>
</head>
<body>
<div class="container">

  <header>
    <div class="header-text">
      <h1><span style="color:#4b5563;">ECZANEDE</span> <span style="color:#00a672;">ÜSTÜNLÜK</span></h1>
      
    </div>
  </header>

  <div class="accordion">

    <div class="acc-item open" id="acc-geri-odemeli">
      <div class="acc-header" onclick="toggle('geri-odemeli')">
        <div class="acc-title">
          <h3>Geri Ödemeli Kârlılık Hesabı</h3>
          
        </div>
        <div class="acc-chevron">▼</div>
      </div>
      <div class="acc-body">
        <div class="acc-content">
          <!-- GİRDİLER AKORDİYON -->
          <div class="inner-acc-item open" id="acc-girdiler" style="border-radius:14px;margin-bottom:12px;border:1px solid var(--border);">
            <div class="acc-header" onclick="event.stopPropagation(); innerToggle('girdiler')" style="border-radius:14px;background:#f9fafb;">
              <div class="acc-title">
                <h3 style="font-size:13px;letter-spacing:1.5px;color:#6b7280;">GİRDİLER</h3>
              </div>
              <div class="acc-chevron">▼</div>
            </div>
            <div class="inner-acc-body">
              <div style="padding:20px 20px 24px;border-top:1px solid var(--border);">
          <div class="form-grid">
            <div class="field full">
              <label>Referans Uygulama Seçiniz</label>
              <select id="go-urun-tipi" onchange="refUygulamaSecim(); hesaplaKamuDSF()">
                <option value="" disabled selected></option>
                <option value="fiyat_korumali">Fiyat Korumalı</option>
                <option value="esdegeri_olmayan">Eşdeğeri Olmayan</option>
                <option value="esdegerli_referans">Eşdeğeri Olan</option>
                <option value="enteral">Enteral Beslenme</option>
              </select>
            </div>

            <div class="field full" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;align-items:end;">
              <div class="field" style="margin:0;">
                <label style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">PSF <span class="hint">(KDV Dahil)</span></label>
                <input type="number" id="go-psf" placeholder="örn. 200.00" step="0.01" oninput="psfDenKDVsiz()">
              </div>
              <div class="field" style="margin:0;">
                <label style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">PSF <span class="hint">(KDV Hariç)</span></label>
                <input type="text" id="go-psf-kdvsiz" placeholder="Otomatik" step="0.01" readonly style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
              <div class="field" style="margin:0;">
                <label style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">DSF <span class="hint">(KDV Hariç)</span></label>
                <input type="text" id="go-dsf" placeholder="Otomatik" step="0.01" readonly style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
            </div>

            <div id="go-referans-tipi-satir" class="field full" style="display:none;grid-template-columns:1fr 1fr 1fr;gap:16px;align-items:end;">
              <div style="grid-column:3;margin:0;">
                <label style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">Referans Tipi</label>
                <select id="go-referans-tipi" onchange="hesaplaKamuDSF()">
                  <option value="" disabled selected></option>
                  <option value="var">Referans Var</option>
                  <option value="yok">Referansı Yok</option>
                  <option value="maliyet">Maliyet Kartı Var</option>
                </select>
              </div>
            </div>

            <div class="field full" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;align-items:end;">
              <div class="field" style="margin:0;">
                <label style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">Kamu PSF <span class="hint">(KDV Dahil)</span></label>
                <input type="text" id="go-kamu-psf" placeholder="Otomatik" step="0.01" readonly style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
              <div class="field" style="margin:0;">
                <label style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">Kamu PSF <span class="hint">(KDV Hariç)</span></label>
                <input type="text" id="go-kamu-psf-kdvsiz" placeholder="Otomatik" step="0.01" readonly style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
              <div class="field" style="margin:0;">
                <label style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;">Kamu DSF <span class="hint">(KDV Hariç)</span></label>
                <input type="text" id="go-kamu-dsf" placeholder="Otomatik" step="0.01" readonly style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
            </div>

            <div class="field full" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;align-items:end;">
              <div class="field" style="margin:0;">
                <label>Satış Adedi</label>
                <input type="number" id="go-satis-adet" placeholder="örn. 100" step="1" oninput="hesaplaOTS(); hesaplaFISS(); hesaplaSatisSartliDSF();">
              </div>
              <div class="field" style="margin:0;">
                <label>MF</label>
                <input type="text" id="go-mf" oninput="hesaplaOTS(); hesaplaSatisSartliDSF();">
              </div>
              <div class="field" style="margin:0;">
                <label>Satış Şartlı DSF</label>
                <input type="text" id="go-satis-sartli-dsf" placeholder="Otomatik" step="0.01" readonly style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
            </div>

            <div class="field full" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:end;">
              <div class="field" style="margin:0;">
                <label>Satış Vadesi <span class="hint">(gün)</span></label>
                <input type="number" id="go-vade" placeholder="örn. 90" step="1" oninput="hesaplaCiktilar();">
              </div>
              <div class="field" style="margin:0;">
                <label>Ort. Yıllık Mevduat Faizi <span class="hint">(%)</span></label>
                <input type="number" id="go-faiz" placeholder="örn. 45" step="0.01" oninput="hesaplaCiktilar();">
              </div>
            </div>

            <div style="grid-column:1/-1;display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:16px;align-items:end;">
              <div class="field">
                <label style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Günlük Satış Adedi</label>
                <input type="number" id="go-gunluk-satis" placeholder="örn. 5" step="1" oninput="hesaplaOTS(); hesaplaFISS(); hesaplaCiktilar();">
              </div>
              <div class="field">
                <label style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Tüketim Süresi</label>
                <input type="number" id="go-tuketim-sure" readonly placeholder="gün" style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
              <div class="field">
                <label style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Fatura İçin Satış Süresi</label>
                <input type="number" id="go-fatura-sure" readonly placeholder="gün" style="background:#f0fdf8;border-color:#00a672;color:#00a672;font-weight:600;">
              </div>
              <div class="field">
                <label style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Geri Ödeme Süresi</label>
                <input type="text" inputmode="numeric" pattern="[0-9]*" id="go-geri-odeme-sure-select" placeholder="gün" list="geri-odeme-liste" style="width:100%;" oninput="hesaplaCiktilar();">
                <datalist id="geri-odeme-liste">
                  <option value="45">
                  <option value="60">
                  <option value="75">
                  <option value="90">
                  <option value="105">
                  <option value="120">
                </datalist>
              </div>
            </div>
          </div>
              </div>
            </div>
          </div>

          <!-- ÇIKTILAR AKORDİYON -->
          <div class="inner-acc-item open" id="acc-ciktilar" style="border-radius:14px;border:1px solid var(--border);">
            <div class="acc-header" onclick="event.stopPropagation(); innerToggle('ciktilar')" style="border-radius:14px;background:#f9fafb;">
              <div class="acc-title">
                <h3 style="font-size:13px;letter-spacing:1.5px;color:#6b7280;">ÇIKTILAR</h3>
              </div>
              <div class="acc-chevron">▼</div>
            </div>
            <div class="inner-acc-body">
              <div style="border-top:1px solid var(--border);">

                <!-- TÜM ÇIKTILAR: TEK GRID -->
                <div style="display:grid;grid-template-columns:auto 1fr 1fr;">

                  <!-- Başlık satırı -->
                  <div style="display:contents;">
                    <div style="padding:12px 20px;border-right:1px solid var(--border);border-bottom:1px solid var(--border);"></div>
                    <div style="padding:12px 20px;border-right:1px solid var(--border);border-bottom:1px solid var(--border);text-align:center;font-size:11px;font-weight:600;letter-spacing:1px;color:#6b7280;text-transform:uppercase;">Kamu</div>
                    <div style="padding:12px 20px;border-bottom:1px solid var(--border);text-align:center;font-size:11px;font-weight:600;letter-spacing:1px;color:#6b7280;text-transform:uppercase;">Elden Satış</div>
                  </div>

                  <!-- Alış-Satış Kârı -->
                  <div style="display:contents;">
                    <div style="padding:16px 20px;display:flex;align-items:center;border-right:1px solid var(--border);border-bottom:1px dashed var(--border);">
                      <span style="font-size:13px;font-weight:500;color:var(--text);white-space:nowrap;">Toplam Alış-Satış Kârı</span>
                    </div>
                    <div style="padding:16px 20px;border-right:1px solid var(--border);border-bottom:1px dashed var(--border);">
                      <input type="text" id="go-alis-satis-kar-kamu" readonly class="cikti-input" style="width:100%;">
                    </div>
                    <div style="padding:16px 20px;border-bottom:1px dashed var(--border);">
                      <input type="text" id="go-alis-satis-kar-elden" readonly class="cikti-input" style="width:100%;">
                    </div>
                  </div>

                  <!-- MF Kârı - tek kutu, 2 kolon kaplıyor -->
                  <div style="display:contents;">
                    <div style="padding:16px 20px;display:flex;align-items:center;border-right:1px solid var(--border);border-bottom:2px solid var(--border);">
                      <span style="font-size:13px;font-weight:500;color:var(--text);white-space:nowrap;">Toplam MF Kârı</span>
                    </div>
                    <div style="padding:16px 20px;grid-column:span 2;border-bottom:2px solid var(--border);">
                      <input type="text" id="go-mf-kar-kamu" readonly class="cikti-input" style="width:100%;">
                    </div>
                  </div>

                  <!-- Tüketim Süresine Göre Valör Kârı - tek kutu -->
                  <div style="display:contents;">
                    <div style="padding:16px 20px;display:flex;align-items:center;border-right:1px solid var(--border);border-bottom:1px dashed var(--border);">
                      <span style="font-size:13px;font-weight:500;color:var(--text);white-space:nowrap;">Tüketim Süresine Göre<br><strong>Valör Kârı</strong></span>
                    </div>
                    <div style="padding:16px 20px;grid-column:span 2;border-bottom:1px dashed var(--border);">
                      <input type="text" id="go-valor-tuketim-kamu" readonly class="cikti-input" style="width:100%;">
                    </div>
                  </div>

                  <!-- Fatura İçin Satış Süresine Göre Valör Kârı - tek kutu -->
                  <div style="display:contents;">
                    <div style="padding:16px 20px;display:flex;align-items:center;border-right:1px solid var(--border);border-bottom:2px solid var(--border);">
                      <span style="font-size:13px;font-weight:500;color:var(--text);white-space:nowrap;">Fatura İçin Satış Süresine Göre<br><strong>Valör Kârı</strong></span>
                    </div>
                    <div style="padding:16px 20px;grid-column:span 2;border-bottom:2px solid var(--border);">
                      <input type="text" id="go-valor-geriodeme-kamu" readonly class="cikti-input" style="width:100%;">
                    </div>
                  </div>

                  <!-- Tüketim Süresine Göre Toplam Kâr -->
                  <div style="display:contents;">
                    <div style="padding:16px 20px;display:flex;align-items:center;border-right:1px solid var(--border);border-bottom:1px dashed var(--border);">
                      <span style="font-size:13px;font-weight:500;color:var(--text);white-space:nowrap;">Tüketim Süresine Göre<br><strong>Toplam Kâr</strong></span>
                    </div>
                    <div style="padding:16px 20px;border-right:1px solid var(--border);border-bottom:1px dashed var(--border);">
                      <input type="text" id="go-toplam-kar-tuketim-kamu" readonly class="cikti-input" style="width:100%;">
                    </div>
                    <div style="padding:16px 20px;border-bottom:1px dashed var(--border);">
                      <input type="text" id="go-toplam-kar-tuketim-elden" readonly class="cikti-input" style="width:100%;">
                    </div>
                  </div>

                  <!-- Fatura İçin Satış Süresine Göre Toplam Kâr -->
                  <div style="display:contents;">
                    <div style="padding:16px 20px;display:flex;align-items:center;border-right:1px solid var(--border);">
                      <span style="font-size:13px;font-weight:500;color:var(--text);white-space:nowrap;">Fatura İçin Satış Süresine Göre<br><strong>Toplam Kâr</strong></span>
                    </div>
                    <div style="padding:16px 20px;border-right:1px solid var(--border);">
                      <input type="text" id="go-toplam-kar-geriodeme-kamu" readonly class="cikti-input" style="width:100%;">
                    </div>
                    <div style="padding:16px 20px;">
                      <input type="text" id="go-toplam-kar-geriodeme-elden" readonly class="cikti-input" style="width:100%;">
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>


  </div><!-- /accordion -->
</div>

<script>
// ── ACCORDION ─────────────────────────────────────────────────────────────
function toggle(id) {
  document.getElementById('acc-' + id).classList.toggle('open');
}

function innerToggle(id) {
  document.getElementById('acc-' + id).classList.toggle('open');
}

// ── FORMAT ────────────────────────────────────────────────────────────────
function fmt(n) {
  return new Intl.NumberFormat('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n) + ' \u20ba';
}
function fmtP(n) {
  return (n >= 0 ? '+' : '') + n.toFixed(2) + '%';
}
function v(id) { return parseFloat(document.getElementById(id).value) || 0; }
function vi(id) { return parseInt(document.getElementById(id).value) || 0; }

function card(label, value, sub, cls) {
  return `<div class="result-card">
    <div class="rc-label">${label}</div>
    <div class="rc-value ${cls||''}">${value}</div>
    ${sub ? `<div class="rc-sub">${sub}</div>` : ''}
  </div>`;
}

// ── KKİ LOOKUP TABLOSU (20/12/2025 itibarıyla geçerli) ────────────────────
const KKI_TABLO = {
  fiyat_korumali: [
    { maxDSF: 45.63,   oran: 0,  aciklama: 'DSF 45,63 \u20ba ve alt\u0131 \u2014 KK\u0130 uygulanmaz' },
    { maxDSF: 87.34,   oran: 0,  aciklama: 'Fiyat korumal\u0131 \u2014 45,64\u201387,34 \u20ba aras\u0131: %0' },
    { maxDSF: 131.60,  oran: 10, aciklama: 'Fiyat korumal\u0131 \u2014 87,35\u2013131,60 \u20ba aras\u0131: %10' },
    { maxDSF: Infinity, oran: 28, aciklama: 'Fiyat korumal\u0131 \u2014 131,61 \u20ba ve \u00fczeri: referans\u0131 var/maliyet kart\u0131 var ise %28, referans\u0131 yok ise %40' },
  ],
  esdegersiz_referans: [
    { maxDSF: 45.63,   oran: 0,  aciklama: 'DSF 45,63 \u20ba ve alt\u0131 \u2014 KK\u0130 uygulanmaz' },
    { maxDSF: 87.34,   oran: 10, aciklama: 'E\u015fde\u011fersiz referans \u2014 45,64\u201387,34 \u20ba: %10' },
    { maxDSF: 131.60,  oran: 31, aciklama: 'E\u015fde\u011fersiz referans \u2014 87,35\u2013131,60 \u20ba: %31' },
    { maxDSF: Infinity, oran: 41, aciklama: 'E\u015fde\u011fersiz referans \u2014 131,61 \u20ba ve \u00fczeri: %41' },
  ],
  esdegerli_referans: [
    { maxDSF: 45.63,   oran: 0,  aciklama: 'DSF 45,63 \u20ba ve alt\u0131 \u2014 KK\u0130 uygulanmaz' },
    { maxDSF: 87.34,   oran: 10, aciklama: 'E\u015fde\u011fer/e\u015fde\u011ferli referans \u2014 45,64\u201387,34 \u20ba: %10' },
    { maxDSF: 131.60,  oran: 18, aciklama: 'E\u015fde\u011fer/e\u015fde\u011ferli referans \u2014 87,35\u2013131,60 \u20ba: %18' },
    { maxDSF: Infinity, oran: 28, aciklama: 'E\u015fde\u011fer/e\u015fde\u011ferli referans \u2014 131,61 \u20ba ve \u00fczeri: %28' },
  ],
  enteral: [
    { maxDSF: 45.63,   oran: 0,  aciklama: 'DSF 45,63 \u20ba ve alt\u0131 \u2014 KK\u0130 uygulanmaz' },
    { maxDSF: 87.34,   oran: 11, aciklama: 'Enteral beslenme \u2014 45,64\u201387,34 \u20ba: %11' },
    { maxDSF: 131.60,  oran: 31, aciklama: 'Enteral beslenme \u2014 87,35\u2013131,60 \u20ba: %31' },
    { maxDSF: Infinity, oran: 41, aciklama: 'Enteral beslenme \u2014 131,61 \u20ba ve \u00fczeri: %41' },
  ],
  kan_mama: [
    { maxDSF: 45.63,   oran: 0,  aciklama: 'DSF 45,63 \u20ba ve alt\u0131 \u2014 KK\u0130 uygulanmaz' },
    { maxDSF: Infinity, oran: 11, aciklama: 'Kan \u00fcr\u00fcn\u00fc/t\u0131bbi mama/radyofarmas\u00f6tik \u2014 45,64 \u20ba ve \u00fczeri: %11 baz iskonto' },
  ],
};

// ── PSF KDV & DSF HESAPLAMA ───────────────────────────────────────────────
function tl(val) {
  return val !== '' && val !== null && !isNaN(val) ? '₺' + parseFloat(val).toFixed(2) : '';
}

function setTL(id, val) {
  const el = document.getElementById(id);
  if (!el) return;
  if (val !== '' && val !== null && !isNaN(val)) {
    const num = parseFloat(val);
    const formatted = num.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    el.value = '₺ ' + formatted;
    const isValor = id.includes('valor') || id.includes('toplam-kar');
    if (isValor && num < 0) {
      el.style.color = '#e63946';
      el.style.borderColor = '#e63946';
      el.style.background = '#fff5f5';
    } else {
      el.style.color = '#00a672';
      el.style.borderColor = '#00a672';
      el.style.background = '#f0fdf8';
    }
  } else {
    el.value = '';
    el.style.color = '#00a672';
    el.style.borderColor = '#00a672';
    el.style.background = '#f0fdf8';
  }
}

function parseTL(id) {
  const el = document.getElementById(id);
  if (!el) return 0;
  return parseFloat(el.value.replace('₺ ', '').replace('₺', '').replace(/\./g, '').replace(',', '.')) || 0;
}

function psfDenKDVsiz() {
  const psf = parseFloat(document.getElementById('go-psf').value) || 0;
  const kdvsizEl = document.getElementById('go-psf-kdvsiz');
  if (psf) {
    const kdvsiz = psf / 1.10;
    setTL('go-psf-kdvsiz', kdvsiz);
    hesaplaDSF(kdvsiz);
  } else {
    kdvsizEl.value = '';
    document.getElementById('go-dsf').value = '';
    document.getElementById('go-kamu-psf').value = '';
    document.getElementById('go-kamu-psf-kdvsiz').value = '';
    document.getElementById('go-kamu-dsf').value = '';
  }
}

function hesaplaDSF(kdvsiz) {
  const K1 = 383.43;
  const K2 = 768.03;
  let dsf = 0;
  if (kdvsiz <= K1) {
    dsf = kdvsiz / 1.28;
  } else if (kdvsiz <= K2) {
    dsf = (K1 / 1.28) + ((kdvsiz - K1) / 1.18);
  } else {
    dsf = (K1 / 1.28) + ((K2 - K1) / 1.18) + ((kdvsiz - K2) / 1.13);
  }
  setTL('go-dsf', dsf);
  hesaplaKamuDSF(dsf);
}

function refUygulamaSecim() {
  const tip = document.getElementById('go-urun-tipi').value;
  const satir = document.getElementById('go-referans-tipi-satir');
  if (tip === 'fiyat_korumali') {
    satir.style.display = 'grid';
  } else {
    satir.style.display = 'none';
    document.getElementById('go-referans-tipi').value = '';
  }
}

function hesaplaKamuDSF(dsfParam) {
  const dsf = dsfParam || parseTL('go-dsf');
  const tip = document.getElementById('go-urun-tipi').value;
  const refTip = document.getElementById('go-referans-tipi').value;

  if (!dsf || !tip) return;

  let oran = 0;

  if (dsf <= 45.63) {
    oran = 0;
  } else if (tip === 'fiyat_korumali') {
    if (dsf <= 87.34)       oran = 0;
    else if (dsf <= 131.60) oran = 10;
    else                    oran = (refTip === 'yok') ? 40 : 28;
  } else if (tip === 'esdegeri_olmayan') {
    if (dsf <= 87.34)       oran = 10;
    else if (dsf <= 131.60) oran = 31;
    else                    oran = 41;
  } else if (tip === 'esdegerli_referans') {
    if (dsf <= 87.34)       oran = 10;
    else if (dsf <= 131.60) oran = 18;
    else                    oran = 28;
  } else if (tip === 'enteral') {
    if (dsf <= 87.34)       oran = 11;
    else if (dsf <= 131.60) oran = 31;
    else                    oran = 41;
  }

  const kamuDsf = dsf * (1 - oran / 100);
  setTL('go-kamu-dsf', kamuDsf);

  // Kamu PSF (KDV hariç) - eczacı kar oranı DSF kademesine göre
  let eczaciKar = 0;
  if (kamuDsf <= 383.43)       eczaciKar = 0.28;
  else if (kamuDsf <= 768.03)  eczaciKar = 0.18;
  else                          eczaciKar = 0.13;

  const kamuPsfKdvsiz = kamuDsf * (1 + eczaciKar);
  setTL('go-kamu-psf-kdvsiz', kamuPsfKdvsiz);
  setTL('go-kamu-psf', kamuPsfKdvsiz * 1.10);
  hesaplaSatisSartliDSF();
}




// ── GERİ ÖDEMELİ HESAPLAMA ───────────────────────────────────────────────


function getGeriOdemeSure() {
  const sel = document.getElementById('go-geri-odeme-sure-select');
  if (sel.style.display === 'none') {
    return parseFloat(document.getElementById('go-geri-odeme-sure-manuel').value) || 0;
  }
  return parseFloat(sel.value) || 0;
}

function hesaplaSatisSartliDSF() {
  const satisAdet = parseFloat(document.getElementById('go-satis-adet').value) || 0;
  const kamuDsf   = parseTL('go-kamu-dsf');
  const mfBed     = parseFloat(document.getElementById('go-mf').value) || 0;
  if (satisAdet && kamuDsf) {
    setTL('go-satis-sartli-dsf', (satisAdet * kamuDsf) / (satisAdet + mfBed));
  } else {
    document.getElementById('go-satis-sartli-dsf').value = '';
  }
  hesaplaCiktilar();
}

function hesaplaCiktilar() {
  const kamuPsfKdvsiz  = parseTL('go-kamu-psf-kdvsiz');
  const psfKdvsiz      = parseTL('go-psf-kdvsiz');
  const kamuDsf        = parseTL('go-kamu-dsf');
  const satisSartliDsf = parseTL('go-satis-sartli-dsf');
  const mf             = parseFloat(document.getElementById('go-mf').value) || 0;

  // Toplam Alış-Satış Kârı (Kamu)
  const satisAdet2 = parseFloat(document.getElementById('go-satis-adet').value) || 0;
  kamuPsfKdvsiz && kamuDsf ? setTL('go-alis-satis-kar-kamu', (kamuPsfKdvsiz - kamuDsf) * satisAdet2) : document.getElementById('go-alis-satis-kar-kamu').value = '';

  // Toplam Alış-Satış Kârı (Elden Satış)
  psfKdvsiz && kamuDsf ? setTL('go-alis-satis-kar-elden', (psfKdvsiz - kamuDsf) * satisAdet2) : document.getElementById('go-alis-satis-kar-elden').value = '';

  // MF Kârı
  mf && kamuDsf ? setTL('go-mf-kar-kamu', mf * kamuDsf) : document.getElementById('go-mf-kar-kamu').value = '';

  // Valör Kârı
  const satisAdet     = parseFloat(document.getElementById('go-satis-adet').value) || 0;
  const vade          = parseFloat(document.getElementById('go-vade').value) || 0;
  const faiz          = parseFloat(document.getElementById('go-faiz').value) || 0;
  const tuketimSure   = parseFloat(document.getElementById('go-tuketim-sure').value) || 0;
  const geriOdemeSure = parseFloat(document.getElementById('go-geri-odeme-sure-select').value) || 0;
  const faturaSure    = parseFloat(document.getElementById('go-fatura-sure').value) || 0;

  if (satisAdet && satisSartliDsf && faiz && vade && tuketimSure && geriOdemeSure) {
    setTL('go-valor-tuketim-kamu', ((satisAdet + mf) * satisSartliDsf) * faiz * ((vade - tuketimSure) - geriOdemeSure) / 36500);
  } else {
    document.getElementById('go-valor-tuketim-kamu').value = '';
  }

  if (satisAdet && satisSartliDsf && faiz && vade && faturaSure && geriOdemeSure) {
    setTL('go-valor-geriodeme-kamu', ((satisAdet + mf) * satisSartliDsf) * faiz * ((vade - faturaSure) - geriOdemeSure) / 36500);
  } else {
    document.getElementById('go-valor-geriodeme-kamu').value = '';
  }

  // Toplam Kâr
  const alisSatisKamuVal  = parseTL('go-alis-satis-kar-kamu');
  const alisSatisEldenVal = parseTL('go-alis-satis-kar-elden');
  const mfKarVal          = parseTL('go-mf-kar-kamu');
  const valorTuketimVal   = parseTL('go-valor-tuketim-kamu');
  const valorFaturaVal    = parseTL('go-valor-geriodeme-kamu');

  setTL('go-toplam-kar-tuketim-kamu',    alisSatisKamuVal  + mfKarVal + valorTuketimVal);
  setTL('go-toplam-kar-tuketim-elden',   alisSatisEldenVal + mfKarVal + valorTuketimVal);
  setTL('go-toplam-kar-geriodeme-kamu',  alisSatisKamuVal  + mfKarVal + valorFaturaVal);
  setTL('go-toplam-kar-geriodeme-elden', alisSatisEldenVal + mfKarVal + valorFaturaVal);
}


function hesaplaFISS() {
  const satisSartliDsf = parseTL('go-satis-sartli-dsf');
  const satisAdet      = parseFloat(document.getElementById('go-satis-adet').value) || 0;
  const mf             = parseFloat(document.getElementById('go-mf').value) || 0;
  const gunlukSatis    = parseFloat(document.getElementById('go-gunluk-satis').value) || 0;
  const kamuPsfKdvsiz  = parseTL('go-kamu-psf-kdvsiz');

  if (satisSartliDsf && satisAdet && gunlukSatis && kamuPsfKdvsiz) {
    const fiss = ((satisAdet + mf) * satisSartliDsf) / (gunlukSatis * kamuPsfKdvsiz);
    const fissYuvarla = (fiss % 1) >= 0.5 ? Math.ceil(fiss) : Math.floor(fiss);
    document.getElementById('go-fatura-sure').value = fissYuvarla;
  } else {
    document.getElementById('go-fatura-sure').value = '';
  }
}

function hesaplaOTS() {
  const satisAdet   = parseFloat(document.getElementById('go-satis-adet').value) || 0;
  const mf          = parseFloat(document.getElementById('go-mf').value) || 0;
  const gunlukSatis = parseFloat(document.getElementById('go-gunluk-satis').value) || 0;

  if (satisAdet && gunlukSatis) {
    const ots = (satisAdet + mf) / gunlukSatis;
    const otsYuvarla = (ots % 1) >= 0.5 ? Math.ceil(ots) : Math.floor(ots);
    document.getElementById('go-tuketim-sure').value = otsYuvarla;
  } else {
    document.getElementById('go-tuketim-sure').value = '';
  }
  hesaplaCiktilar();
}


function hesaplaGO() {
  const psf          = v('go-psf');
  const kki          = v('go-kki') / 100;
  const vade         = vi('go-vade');
  const mfAl         = v('go-mf-al') || 1;
  const mfBed        = v('go-mf-bed') || 0;
  const depoIsk      = v('go-depo-isk') / 100;
  const siparisAdet  = v('go-siparis-adet') || 1;
  const gunlukSatis  = v('go-gunluk-satis') || 1;
  const sgkGun       = getGeriOdemeSure() || 35;
  const yillikFaiz   = v('go-faiz') || 0;
  const dsf          = v('go-dsf');

  if (!psf) { alert('Lütfen PSF girin.'); return; }
  if (!dsf) { alert('DSF hesaplanamadı. Lütfen PSF girin.'); return; }
  if (!kki && kki !== 0) { alert('Lütfen ürün tipini seçin.'); return; }

  // Satış fiyatı (KDV hariç) = PSF / 1.10
  const satisFiyatNet = psf / 1.10;

  // SGK kamu fiyatı = PSF üzerinden KKİ düşülür
  const kamufiyat = satisFiyatNet * (1 - kki);

  // Alış: eczane DSF'den alır, MF ve depo iskontosu uygulanır
  const mfCarpan = mfBed > 0 ? (mfAl + mfBed) / mfAl : 1;
  const alisNetFinal = (dsf / mfCarpan) * (1 - depoIsk);

  const toplamAlis  = alisNetFinal * siparisAdet;
  const toplamSatis = kamufiyat * siparisAdet;
  const brutKar     = toplamSatis - toplamAlis;
  const brutKarOran = (brutKar / toplamAlis) * 100;

  const stoktaBitisGun = siparisAdet / gunlukSatis;
  const parasininGelisGunu = stoktaBitisGun + sgkGun;
  const valorGun = vade - parasininGelisGunu;
  const valorTL = yillikFaiz > 0 ? (toplamAlis * yillikFaiz * Math.abs(valorGun)) / 36500 : 0;
  const valorPozitif = valorGun >= 0;

  const toplamKarlilik = brutKar + (valorPozitif ? valorTL : -valorTL);

  document.getElementById('go-result-grid').innerHTML =
    card('Birim Alış (DSF)', fmt(dsf), 'Depocuya ödenen fiyat') +
    card('Birim Alış (Net)', fmt(alisNetFinal), 'MF + depo iskontosu sonrası') +
    card('SGK Kamu Fiyatı', fmt(kamufiyat), 'PSF/1.10 × (1-KKİ%)') +
    card('Toplam Alış', fmt(toplamAlis), siparisAdet + ' adet') +
    card('Toplam SGK Geliri', fmt(toplamSatis), siparisAdet + ' adet') +
    card('Brüt Kar', fmt(brutKar), fmtP(brutKarOran), brutKar >= 0 ? 'positive' : 'negative');

  document.getElementById('go-valor-value').textContent = fmt(valorTL) + (valorPozitif ? ' KAZANÇ' : ' KAYIP');
  document.getElementById('go-valor-value').className = 'vb-value ' + (valorPozitif ? 'positive' : 'negative');
  document.getElementById('go-valor-desc').innerHTML =
    `Stok <b>${stoktaBitisGun.toFixed(0)} günde</b> tükeniyor. ` +
    `SGK ödemesi ~<b>${parasininGelisGunu.toFixed(0)}. günde</b> geliyor. ` +
    `Vade <b>${vade} gün</b>. ` +
    (valorPozitif
      ? `<b style="color:#00a672">+${valorGun.toFixed(0)} gün valör avantajı</b>`
      : `<b style="color:#e63946">${Math.abs(valorGun).toFixed(0)} gün valör açığı</b>`);

  document.getElementById('go-total').textContent = fmt(toplamKarlilik);
  document.getElementById('go-results').classList.add('show');
}


// ── GERİ ÖDEMESİZ HESAPLAMA ──────────────────────────────────────────────

</script>
</body>
</html>
